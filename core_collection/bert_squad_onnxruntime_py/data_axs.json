{
    "_parent_entries": [ [ "^", "byname", "python_script" ] ],
    "_producer_rules": [
        [ [ "script_output", "bert_squad", "framework=onnx" ], [["run"]], { "return_saved_record_entry": true } ]
    ],

    "num_gpus": [ "^", "execute", [[
                       [ "byquery", "shell_tool,can_gpu" ],
                       [ "run" ]
                ]] ],

    "onnxruntime_name": ["^", "case",[ ["^^", "get", "num_gpus"], "0", "package_name=onnxruntime" ],
                                     {"default_value": "package_name=onnxruntime-gpu"}, ["num_gpus"]],
    "onnxruntime_query": [ "^^", "case", [ ["^^", "get", "python_version"],
                                           "Python 3.6.9",
                                           [ "python_package", ["^^", "get", "onnxruntime_name"], "for_python36" ] ],
                                       {"default_value": [ "python_package", ["^^", "get", "onnxruntime_name"] ] } ],

    "tensorflow_query": ["python_package", "package_name=tensorflow"],
    "torch_query": [ "^^", "case", [ [ "^^", "get", "num_gpus"] , "0" ,["python_package", "package_name=torch"] ], {"default_value": ["python_package", "package_name=torch", "with_cuda"] } ],
    "python_deps": [
        [ "^", "byquery", [ [ "^^", "get", "tensorflow_query" ] ], {}, ["tensorflow_query"] ],
        [ "^", "byquery", [ [ "^^", "get", "onnxruntime_query" ] ], {}, ["onnxruntime_query"] ],
        [ "^", "byquery", [ [ "^^", "get", "torch_query" ] ], {}, ["torch_query"] ]
    ],
    "mlperf_inference_git_entry": [ "^", "byquery", "git_repo,repo_name=mlperf_inference_git" ],

    "mlperf_inference_path": [ "^^", "execute", [[
        [ "get", "mlperf_inference_git_entry" ],
        [ "get_path", [[""]] ]
    ]], {}, ["mlperf_inference_git_entry"] ],

    "model_name": "bert_large",
    "model_query": [ "downloaded", "onnx_model", [ "^^", "substitute", "model_name=#{model_name}#" ] ],
    "model_entry": [ "^", "byquery", [[ "^^", "get", "model_query" ]], {}, ["model_query"] ],
    "model_path": [ "^^", "execute", [[
        [ "get", "model_entry" ],
        [ "get_path" ]
    ]] ],

    "squad_dataset_query":[ "downloaded", "squad_original" ],
    "squad_dataset_entry": [ "^", "byquery", [[ "^^", "get", "squad_dataset_query" ]], {}, ["squad_dataset_query"] ],
    "squad_dataset_original_path": [ "^^", "execute", [[
        [ "get", "squad_dataset_entry" ],
        [ "get_path" ]
    ]] ],

    "batch_size": "1",
    "batch_count": "1",

    "tokenized_squad_query":[ "tokenized", "squad_v1_1" ],
    "tokenized_squad_entry": [ "^", "byquery", [[ "^^", "get", "tokenized_squad_query" ]], {}, ["tokenized_squad_query"] ],
    "tokenized_squad_path": [ "^^", "execute", [[
        [ "get", "tokenized_squad_entry" ],
        [ "get_path" ]
    ]] ],

    "framework": "onnx",
    "execution_device": "",
    "rel_script_path": "bert_squad_onnxruntime.py",

    "script_extra_params": [ "^^", "substitute", "\"#{mlperf_inference_path}#\" \"#{squad_dataset_original_path}#\" \"#{tokenized_squad_path}#\" \"#{model_path}#\" \"#{batch_size}#\" \"#{batch_count}#\" \"#{execution_device}#\"" ]
}
